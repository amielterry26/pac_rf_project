#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "../include/config.h"
#include "../include/handlers.h"

typedef struct {
    const char *cmd;
    void (*handler)(void);
} Command;

Command command_table[] = {
    {"--capture", handle_capture},
    {"--gps", handle_gps},
    {"--stream-start", handle_stream_start},
    {"--tone-send", handle_send_tone}, // fixed name
};

// Macro to compute number of commands
#define COMMAND_COUNT (sizeof(command_table) / sizeof(command_table[0]))

int main(int argc, char *argv[]) {
    if (argc < 2) {
        printf("Usage: %s <command> [options]\n", argv[0]);
        return 1;
    }

    char *cmd = argv[1];
    int handled = 0;

    for (size_t i = 0; i < COMMAND_COUNT; i++) {
        if (strcmp(cmd, command_table[i].cmd) == 0) {
            command_table[i].handler();
            handled = 1;
            break;
        }
    }

    if (!handled) {
        printf("Unknown command: %s\n", cmd);
        printf("Available commands:\n");
        for (size_t i = 0; i < COMMAND_COUNT; i++) {
            printf("  %s\n", command_table[i].cmd);
        }
        return 1;
    }

    return 0;
}
